<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>TON Miner Game</title>
    
    <!-- Telegram Web App SDK -->
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #0a0a0a 0%, #1a1a2e 50%, #16213e 100%);
            color: white;
            min-height: 100vh;
            padding: 20px;
            padding-top: env(safe-area-inset-top);
            padding-bottom: env(safe-area-inset-bottom);
        }
        
        .container {
            max-width: 500px;
            margin: 0 auto;
        }
        
        /* –®–∞–ø–∫–∞ Telegram */
        .tg-header {
            background: linear-gradient(135deg, #0088cc, #0066aa);
            padding: 15px;
            border-radius: 15px;
            margin-bottom: 20px;
            text-align: center;
            box-shadow: 0 5px 20px rgba(0, 136, 204, 0.4);
            border: 2px solid #00aaff;
        }
        
        .tg-header h1 {
            font-size: 1.8em;
            color: white;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
            margin-bottom: 5px;
        }
        
        .player-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: rgba(255,255,255,0.1);
            padding: 10px 15px;
            border-radius: 12px;
            margin-bottom: 20px;
            backdrop-filter: blur(10px);
        }
        
        .player-avatar {
            width: 40px;
            height: 40px;
            background: linear-gradient(45deg, #ff3366, #cc33ff);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 1.2em;
        }
        
        /* –û—Å–Ω–æ–≤–Ω–æ–π –±–ª–æ–∫ –∏–≥—Ä—ã */
        .game-card {
            background: rgba(30, 30, 46, 0.95);
            border-radius: 20px;
            padding: 25px;
            margin-bottom: 20px;
            border: 2px solid #00ffff;
            box-shadow: 0 10px 30px rgba(0, 255, 255, 0.2);
            text-align: center;
        }
        
        .price-container {
            margin: 20px 0;
        }
        
        .price-label {
            color: #88ffff;
            font-size: 0.9em;
            margin-bottom: 5px;
        }
        
        .price {
            font-size: 3.5em;
            font-weight: 800;
            color: #00ffaa;
            text-shadow: 0 0 20px rgba(0, 255, 170, 0.5);
            margin: 10px 0;
            transition: all 0.3s;
        }
        
        .chart {
            font-family: monospace;
            font-size: 1.3em;
            color: #ffcc00;
            margin: 15px 0;
            letter-spacing: 2px;
            overflow: hidden;
        }
        
        /* –û—Å–Ω–æ–≤–Ω–∞—è –∫–Ω–æ–ø–∫–∞ */
        .main-btn {
            width: 100%;
            padding: 25px;
            font-size: 1.8em;
            font-weight: bold;
            background: linear-gradient(45deg, #ff3366, #cc33ff);
            color: white;
            border: none;
            border-radius: 20px;
            margin: 20px 0;
            cursor: pointer;
            transition: all 0.2s;
            box-shadow: 0 10px 25px rgba(255, 51, 102, 0.4);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        .main-btn:active {
            transform: scale(0.95);
            box-shadow: 0 5px 15px rgba(255, 51, 102, 0.6);
        }
        
        /* –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin: 20px 0;
        }
        
        .stat-item {
            background: rgba(255,255,255,0.08);
            border-radius: 15px;
            padding: 15px;
            text-align: center;
            border: 1px solid rgba(255,255,255,0.1);
        }
        
        .stat-label {
            color: #88aaff;
            font-size: 0.8em;
            margin-bottom: 5px;
        }
        
        .stat-value {
            font-size: 1.8em;
            font-weight: bold;
            color: white;
        }
        
        /* –£–ª—É—á—à–µ–Ω–∏—è */
        .upgrades-section {
            background: rgba(0, 40, 80, 0.4);
            border-radius: 20px;
            padding: 20px;
            margin: 25px 0;
            border: 1px solid rgba(0, 136, 255, 0.3);
        }
        
        .section-title {
            color: #00aaff;
            font-size: 1.3em;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .upgrade-item {
            background: rgba(0, 100, 200, 0.25);
            border-radius: 15px;
            padding: 15px;
            margin-bottom: 12px;
            border: 1px solid rgba(0, 136, 255, 0.5);
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .upgrade-item:active {
            transform: translateX(5px);
            background: rgba(0, 120, 220, 0.4);
        }
        
        .upgrade-info {
            flex: 1;
        }
        
        .upgrade-name {
            font-weight: bold;
            color: white;
            margin-bottom: 3px;
            font-size: 1.1em;
        }
        
        .upgrade-desc {
            font-size: 0.8em;
            color: #88ccff;
        }
        
        .upgrade-price {
            color: #ffcc00;
            font-weight: bold;
            font-size: 1.2em;
            min-width: 80px;
            text-align: right;
        }
        
        /* Telegram –∫–Ω–æ–ø–∫–∏ */
        .tg-buttons {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin: 20px 0;
        }
        
        .tg-button {
            background: linear-gradient(135deg, #0088cc, #0066aa);
            color: white;
            border: none;
            border-radius: 15px;
            padding: 15px 10px;
            font-size: 0.9em;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 5px;
        }
        
        .tg-button:active {
            transform: scale(0.95);
        }
        
        .tg-button.premium {
            background: linear-gradient(135deg, #ffcc00, #ff9900);
        }
        
        .tg-button.ton {
            background: linear-gradient(135deg, #00cc88, #00aa66);
        }
        
        /* –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è */
        .notification {
            position: fixed;
            bottom: 20px;
            left: 20px;
            right: 20px;
            background: linear-gradient(135deg, #00ff88, #00cc66);
            color: #003311;
            padding: 15px 20px;
            border-radius: 15px;
            font-weight: bold;
            z-index: 1000;
            box-shadow: 0 10px 25px rgba(0, 255, 136, 0.4);
            animation: slideUp 0.3s ease-out;
            text-align: center;
            border: 2px solid #00aa55;
            display: none;
        }
        
        @keyframes slideUp {
            from { transform: translateY(100px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        
        /* –ó–∞–≥—Ä—É–∑–∫–∞ */
        .loading {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: #0a0a0a;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 10000;
            gap: 20px;
        }
        
        .loader {
            width: 50px;
            height: 50px;
            border: 5px solid rgba(0, 136, 204, 0.3);
            border-top-color: #0088cc;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        /* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å */
        @media (max-width: 400px) {
            .price { font-size: 2.8em; }
            .main-btn { font-size: 1.5em; padding: 20px; }
            .tg-buttons { grid-template-columns: repeat(2, 1fr); }
        }
    </style>
</head>
<body>
    <!-- –ó–∞–≥—Ä—É–∑–∫–∞ -->
    <div class="loading" id="loading">
        <div class="loader"></div>
        <div>–ó–∞–≥—Ä—É–∑–∫–∞ –∏–≥—Ä—ã...</div>
    </div>
    
    <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä -->
    <div class="container" id="gameContainer" style="display: none;">
        <!-- –®–∞–ø–∫–∞ Telegram -->
        <div class="tg-header">
            <h1>üöÄ TON MINER</h1>
            <div style="font-size: 0.9em; opacity: 0.9;">–ö–∞—á–∞–π —Ü–µ–Ω—É TON –¥–æ –ª—É–Ω—ã!</div>
        </div>
        
        <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –∏–≥—Ä–æ–∫–∞ -->
        <div class="player-info">
            <div class="player-avatar" id="playerAvatar">U</div>
            <div style="flex: 1; margin-left: 15px;">
                <div style="font-weight: bold;" id="playerName">–ò–≥—Ä–æ–∫</div>
                <div style="color: #00ff88; font-size: 1.1em;">–ë–∞–ª–∞–Ω—Å: <span id="playerBalance">0</span> TON</div>
            </div>
            <div style="color: #ffcc00; font-weight: bold; font-size: 1.2em;">
                –£—Ä. <span id="playerLevel">1</span>
            </div>
        </div>
        
        <!-- –û—Å–Ω–æ–≤–Ω–∞—è –∏–≥—Ä–∞ -->
        <div class="game-card">
            <div class="price-container">
                <div class="price-label">üí∞ –¶–ï–ù–ê TON</div>
                <div class="price" id="price">$1.00</div>
                <div class="chart" id="chart">[‚ñÜ‚ñÜ‚ñÜ‚ñÜ‚ñÜ‚ñÜ‚ñÜ‚ñÜ‚ñÜ‚ñÜ‚ñÜ‚ñÜ‚ñÜ‚ñÜ‚ñÜ‚ñÜ‚ñÜ‚ñÜ‚ñÜ‚ñÜ]</div>
                <div class="price-label">üìà +<span id="growthRate">0.01</span>/–∫–ª–∏–∫</div>
            </div>
            
            <button class="main-btn" onclick="clickTon()" id="clickBtn">
                <span>üöÄ</span>
                <span>–ù–ê–ö–ê–ß–ê–¢–¨ TON</span>
            </button>
        </div>
        
        <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
        <div class="stats-grid">
            <div class="stat-item">
                <div class="stat-label">–ë–∞–ª–∞–Ω—Å</div>
                <div class="stat-value" id="balance">0</div>
            </div>
            <div class="stat-item">
                <div class="stat-label">–•–µ—à—Ä–µ–π—Ç</div>
                <div class="stat-value" id="hashrate">1</div>
            </div>
            <div class="stat-item">
                <div class="stat-label">–î—Ä—É–∑–µ–π</div>
                <div class="stat-value" id="friends">0</div>
            </div>
            <div class="stat-item">
                <div class="stat-label">–£—Ä–æ–≤–µ–Ω—å</div>
                <div class="stat-value" id="level">1</div>
            </div>
        </div>
        
        <!-- –ê–≤—Ç–æ-—Ñ–µ—Ä–º–∞ -->
        <div style="background: rgba(0,255,200,0.1); border-radius: 15px; padding: 15px; margin: 20px 0; text-align: center; border: 1px solid #00ffcc;">
            <div style="color: #00ffcc; font-weight: bold;">ü§ñ –ê–í–¢–û-–§–ï–†–ú–ê</div>
            <div style="margin-top: 5px; font-size: 0.9em;">
                –î–æ–±—ã—á–∞: <span id="autoPerSecond">0</span> TON/—Å–µ–∫
                ‚Ä¢ –í—Å–µ–≥–æ: <span id="autoTotal">0</span> TON
            </div>
        </div>
        
        <!-- –£–ª—É—á—à–µ–Ω–∏—è -->
        <div class="upgrades-section">
            <div class="section-title">‚ö° –£–õ–£–ß–®–ï–ù–ò–Ø</div>
            
            <div class="upgrade-item" onclick="buyUpgrade('gpu')">
                <div class="upgrade-info">
                    <div class="upgrade-name">üíª –í–∏–¥–µ–æ–∫–∞—Ä—Ç–∞</div>
                    <div class="upgrade-desc">+5 GH/s, +0.3% –∫ —Ü–µ–Ω–µ</div>
                </div>
                <div class="upgrade-price" id="gpuPrice">50 TON</div>
            </div>
            
            <div class="upgrade-item" onclick="buyUpgrade('farm')">
                <div class="upgrade-info">
                    <div class="upgrade-name">üåê –ú–∞–π–Ω–∏–Ω–≥-—Ñ–µ—Ä–º–∞</div>
                    <div class="upgrade-desc">+25 GH/s –∞–≤—Ç–æ-–¥–æ–±—ã—á–∏</div>
                </div>
                <div class="upgrade-price" id="farmPrice">250 TON</div>
            </div>
            
            <div class="upgrade-item" onclick="buyUpgrade('bot')" id="botUpgrade" style="display: none;">
                <div class="upgrade-info">
                    <div class="upgrade-name">ü§ñ –¢–æ—Ä–≥–æ–≤—ã–π –±–æ—Ç</div>
                    <div class="upgrade-desc">x2 –∫ —Å–∏–ª–µ –∫–ª–∏–∫–æ–≤</div>
                </div>
                <div class="upgrade-price" id="botPrice">500 TON</div>
            </div>
            
            <div class="upgrade-item" onclick="buyUpgrade('exchange')" id="exchangeUpgrade" style="display: none;">
                <div class="upgrade-info">
                    <div class="upgrade-name">üè¶ –ö—Ä–∏–ø—Ç–æ–±–∏—Ä–∂–∞</div>
                    <div class="upgrade-desc">x3 –∫ –∞–≤—Ç–æ-–¥–æ–±—ã—á–µ</div>
                </div>
                <div class="upgrade-price" id="exchangePrice">2000 TON</div>
            </div>
        </div>
        
        <!-- Telegram –∫–Ω–æ–ø–∫–∏ -->
        <div class="tg-buttons">
            <button class="tg-button" onclick="inviteFriend()">
                <span>üë•</span>
                <span>–ü—Ä–∏–≥–ª–∞—Å–∏—Ç—å</span>
            </button>
            
            <button class="tg-button ton" onclick="buyWithTon()">
                <span>üí∞</span>
                <span>–ö—É–ø–∏—Ç—å TON</span>
            </button>
            
            <button class="tg-button" onclick="showLeaderboard()">
                <span>üèÜ</span>
                <span>–¢–æ–ø</span>
            </button>
            
            <button class="tg-button premium" onclick="activatePremium()">
                <span>‚≠ê</span>
                <span>Premium</span>
            </button>
            
            <button class="tg-button" onclick="shareGame()">
                <span>üì¢</span>
                <span>–ü–æ–¥–µ–ª–∏—Ç—å—Å—è</span>
            </button>
            
            <button class="tg-button" onclick="claimDaily()">
                <span>üéÅ</span>
                <span>–ë–æ–Ω—É—Å</span>
            </button>
        </div>
        
        <!-- –î–æ—Å—Ç–∏–∂–µ–Ω–∏—è -->
        <div style="text-align: center; margin-top: 30px; color: #88aaff; font-size: 0.9em;">
            üéØ –¶–µ–ª—å: $<span id="nextGoal">5</span> ‚Ä¢ –ù–∞–≥—Ä–∞–¥–∞: <span id="goalReward">x1.5 –∫ —Ö–µ—à—Ä–µ–π—Ç—É</span>
        </div>
    </div>
    
    <!-- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ -->
    <div class="notification" id="notification"></div>

    <script>
        // ==================== –¢–ï–õ–ï–ì–†–ê–ú –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø ====================
        let tg = window.Telegram?.WebApp;
        let isTelegram = false;
        
        function initTelegram() {
            if (tg) {
                isTelegram = true;
                tg.expand();
                tg.ready();
                tg.enableClosingConfirmation();
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                const user = tg.initDataUnsafe.user;
                if (user) {
                    document.getElementById('playerName').textContent = user.first_name || '–ò–≥—Ä–æ–∫';
                    document.getElementById('playerAvatar').textContent = user.first_name ? user.first_name[0].toUpperCase() : 'U';
                    document.getElementById('playerAvatar').style.background = 
                        `linear-gradient(45deg, #${Math.floor(Math.random()*16777215).toString(16)}, #${Math.floor(Math.random()*16777215).toString(16)})`;
                }
                
                // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏–∑ Telegram Cloud
                tg.CloudStorage.getItem('tonMinerSave', (err, data) => {
                    if (data) {
                        loadGameData(JSON.parse(data));
                    }
                    hideLoading();
                });
                
                console.log('‚úÖ –ó–∞–ø—É—â–µ–Ω–æ –≤ Telegram');
            } else {
                // –ó–∞–ø—É—â–µ–Ω–æ –≤ –±—Ä–∞—É–∑–µ—Ä–µ
                const saved = localStorage.getItem('tonMinerSave');
                if (saved) {
                    loadGameData(JSON.parse(saved));
                }
                hideLoading();
                console.log('‚úÖ –ó–∞–ø—É—â–µ–Ω–æ –≤ –±—Ä–∞—É–∑–µ—Ä–µ');
            }
        }
        
        // ==================== –ò–ì–†–û–í–ê–Ø –õ–û–ì–ò–ö–ê ====================
        let game = {
            version: 3,
            price: 1.00,
            balance: 0,
            hashrate: 1,
            level: 1,
            friends: 0,
            totalClicks: 0,
            totalMined: 0,
            autoMinedTotal: 0,
            upgrades: {
                gpu: 0,
                farm: 0,
                bot: false,
                exchange: false
            },
            achievements: {}
        };
        
        const goals = [
            { price: 5, reward: "x1.5 –∫ —Ö–µ—à—Ä–µ–π—Ç—É", multiplier: 1.5 },
            { price: 10, reward: "x2 –∫–æ –≤—Å–µ–º—É", multiplier: 2 },
            { price: 25, reward: "x3 –∫ –∞–≤—Ç–æ-–¥–æ–±—ã—á–µ", multiplier: 3 },
            { price: 100, reward: "–ú–ê–ö–°–ò–ú–£–ú", multiplier: 5 }
        ];
        
        // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö
        function loadGameData(data) {
            if (data.version === game.version) {
                game = data;
                updateUI();
                
                // –ó–∞–ø—É—Å–∫–∞–µ–º –∞–≤—Ç–æ-—Ñ–µ—Ä–º—É –µ—Å–ª–∏ –µ—Å—Ç—å
                if (game.upgrades.farm > 0) {
                    startAutoFarm();
                }
                
                // –û—Ç–∫—Ä—ã–≤–∞–µ–º —É–ª—É—á—à–µ–Ω–∏—è –µ—Å–ª–∏ –¥–æ—Å—Ç–∏–≥–ª–∏ —Ü–µ–Ω
                if (game.price >= 5) {
                    document.getElementById('botUpgrade').style.display = 'flex';
                }
                if (game.price >= 20) {
                    document.getElementById('exchangeUpgrade').style.display = 'flex';
                }
            }
        }
        
        // –û—Å–Ω–æ–≤–Ω–æ–π –∫–ª–∏–∫
        function clickTon() {
            game.totalClicks++;
            
            let clickPower = 0.01;
            let hashPower = game.hashrate;
            
            // –ë–æ–Ω—É—Å—ã –æ—Ç —É–ª—É—á—à–µ–Ω–∏–π
            clickPower += game.upgrades.gpu * 0.003;
            hashPower += game.upgrades.gpu * 5;
            
            if (game.upgrades.bot) {
                clickPower *= 2;
            }
            
            // –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º —Ü–µ–Ω—É
            game.price += clickPower + (Math.random() * 0.01);
            
            // –î–æ–±—ã–≤–∞–µ–º TON
            const mined = hashPower * (1 + game.friends * 0.1);
            game.balance += mined;
            game.totalMined += mined;
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ü–µ–ª–∏
            checkGoals();
            
            updateUI();
            saveGame();
            
            // –ê–Ω–∏–º–∞—Ü–∏—è
            const btn = document.getElementById('clickBtn');
            btn.style.transform = 'scale(0.95)';
            setTimeout(() => btn.style.transform = 'scale(1)', 100);
            
            // –°–ª—É—á–∞–π–Ω—ã–π –ø–∞–º–ø
            if (Math.random() < 0.03) {
                const pump = 0.1 + (game.upgrades.gpu * 0.01);
                game.price *= (1 + pump);
                showNotification(`üìà –ü–ê–ú–ü! –¶–µ–Ω–∞ +${(pump*100).toFixed(1)}%!`, '#ffaa00');
            }
        }
        
        // –ü–æ–∫—É–ø–∫–∞ —É–ª—É—á—à–µ–Ω–∏–π
        function buyUpgrade(type) {
            let price = 0;
            let message = '';
            
            switch(type) {
                case 'gpu':
                    price = Math.floor(50 * Math.pow(1.2, game.upgrades.gpu));
                    if (game.balance >= price) {
                        game.balance -= price;
                        game.upgrades.gpu++;
                        game.hashrate += 5;
                        message = 'üíª –í–∏–¥–µ–æ–∫–∞—Ä—Ç–∞ –∫—É–ø–ª–µ–Ω–∞! +5 GH/s';
                    }
                    break;
                    
                case 'farm':
                    price = Math.floor(250 * Math.pow(1.3, game.upgrades.farm));
                    if (game.balance >= price) {
                        game.balance -= price;
                        game.upgrades.farm++;
                        message = 'üåê –ú–∞–π–Ω–∏–Ω–≥-—Ñ–µ—Ä–º–∞ –∫—É–ø–ª–µ–Ω–∞!';
                        startAutoFarm();
                    }
                    break;
                    
                case 'bot':
                    price = 500;
                    if (!game.upgrades.bot && game.balance >= price) {
                        game.balance -= price;
                        game.upgrades.bot = true;
                        message = 'ü§ñ –¢–æ—Ä–≥–æ–≤—ã–π –±–æ—Ç –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω! –ö–ª–∏–∫–∏ x2!';
                    }
                    break;
                    
                case 'exchange':
                    price = 2000;
                    if (!game.upgrades.exchange && game.balance >= price) {
                        game.balance -= price;
                        game.upgrades.exchange = true;
                        message = 'üè¶ –ö—Ä–∏–ø—Ç–æ–±–∏—Ä–∂–∞ –∫—É–ø–ª–µ–Ω–∞! –ê–≤—Ç–æ-–¥–æ–±—ã—á–∞ x3!';
                    }
                    break;
            }
            
            if (message) {
                showNotification(message);
                updateUI();
                saveGame();
            } else if (price > 0 && game.balance < price) {
                showNotification(`‚ùå –ù—É–∂–Ω–æ –µ—â—ë ${Math.ceil(price - game.balance)} TON`, true);
            }
        }
        
        // –ê–≤—Ç–æ-—Ñ–µ—Ä–º–∞
        let autoFarmInterval;
        function startAutoFarm() {
            if (autoFarmInterval) clearInterval(autoFarmInterval);
            
            autoFarmInterval = setInterval(() => {
                if (game.upgrades.farm > 0) {
                    let autoPower = game.upgrades.farm * 25;
                    if (game.upgrades.exchange) {
                        autoPower *= 3;
                    }
                    
                    game.balance += autoPower;
                    game.totalMined += autoPower;
                    game.autoMinedTotal += autoPower;
                    
                    updateUI();
                    saveGame();
                }
            }, 1000);
        }
        
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ü–µ–ª–µ–π
        function checkGoals() {
            const nextGoal = goals.find(g => game.price < g.price);
            if (nextGoal) {
                document.getElementById('nextGoal').textContent = nextGoal.price;
                document.getElementById('goalReward').textContent = nextGoal.reward;
                
                // –ï—Å–ª–∏ –¥–æ—Å—Ç–∏–≥–ª–∏ —Ü–µ–ª–∏
                const achieved = goals.find(g => game.price >= g.price && !game.achievements[`goal_${g.price}`]);
                if (achieved) {
                    game.achievements[`goal_${achieved.price}`] = true;
                    game.hashrate *= achieved.multiplier;
                    game.level++;
                    
                    showNotification(`üéâ –¶–µ–ª—å $${achieved.price} –¥–æ—Å—Ç–∏–≥–Ω—É—Ç–∞! ${achieved.reward}`, '#ff00ff');
                    
                    // –û—Ç–∫—Ä—ã–≤–∞–µ–º –Ω–æ–≤—ã–µ —É–ª—É—á—à–µ–Ω–∏—è
                    if (achieved.price >= 5) {
                        document.getElementById('botUpgrade').style.display = 'flex';
                    }
                    if (achieved.price >= 20) {
                        document.getElementById('exchangeUpgrade').style.display = 'flex';
                    }
                }
            }
        }
        
        // ==================== TELEGRAM –§–£–ù–ö–¶–ò–ò ====================
        function inviteFriend() {
            if (isTelegram) {
                const url = window.location.href;
                const text = 'üéÆ –ö–∞—á–∞–π TON –¥–æ –ª—É–Ω—ã –≤ TON Miner! –ü—Ä–∏—Å–æ–µ–¥–∏–Ω—è–π—Å—è!';
                tg.shareUrl(url, text, (shared) => {
                    if (shared) {
                        game.friends++;
                        game.balance += 100;
                        showNotification('üë• –î—Ä—É–≥ –ø—Ä–∏–≥–ª–∞—à—ë–Ω! +100 TON');
                        updateUI();
                        saveGame();
                    }
                });
            } else {
                const url = window.location.href;
                navigator.clipboard.writeText(url);
                showNotification('üìã –°—Å—ã–ª–∫–∞ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞! –û—Ç–ø—Ä–∞–≤—å –¥—Ä—É–≥—É.');
            }
        }
        
        function buyWithTon() {
            if (isTelegram) {
                tg.showPopup({
                    title: 'üí∞ –ö—É–ø–∏—Ç—å TON',
                    message: '–í—ã–±–µ—Ä–∏—Ç–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏–≥—Ä–æ–≤—ã—Ö TON:',
                    buttons: [
                        {id: 'buy100', type: 'default', text: '100 TON - 0.5 TON'},
                        {id: 'buy500', type: 'default', text: '500 TON - 2 TON'},
                        {id: 'buy1000', type: 'default', text: '1000 TON - 4 TON'},
                        {type: 'cancel'}
                    ]
                }, (btnId) => {
                    if (btnId === 'buy100') {
                        game.balance += 100;
                        showNotification('‚úÖ –ö—É–ø–ª–µ–Ω–æ 100 TON!');
                        updateUI();
                        saveGame();
                    } else if (btnId === 'buy500') {
                        game.balance += 500;
                        showNotification('‚úÖ –ö—É–ø–ª–µ–Ω–æ 500 TON!');
                        updateUI();
                        saveGame();
                    } else if (btnId === 'buy1000') {
                        game.balance += 1000;
                        showNotification('‚úÖ –ö—É–ø–ª–µ–Ω–æ 1000 TON!');
                        updateUI();
                        saveGame();
                    }
                });
            } else {
                showNotification('üí∞ –í Telegram –¥–æ—Å—Ç—É–ø–Ω–∞ –ø–æ–∫—É–ø–∫–∞ TON!', true);
            }
        }
        
        function showLeaderboard() {
            if (isTelegram) {
                tg.showAlert(`üèÜ –¢–æ–ø –∏–≥—Ä–æ–∫–æ–≤ TON Miner:\n\nü•á –ò–≤–∞–Ω - $245.60\nü•à –ú–∞—Ä–∏—è - $189.20\nü•â –ê–ª–µ–∫—Å - $156.80\n\n–¢—ã: $${game.price.toFixed(2)}`);
            } else {
                alert(`üèÜ –¢–æ–ø –∏–≥—Ä–æ–∫–æ–≤:\n\n1. –ò–≤–∞–Ω - $245.60\n2. –ú–∞—Ä–∏—è - $189.20\n3. –ê–ª–µ–∫—Å - $156.80\n\n–¢—ã: $${game.price.toFixed(2)}`);
            }
        }
        
        function activatePremium() {
            if (isTelegram) {
                tg.showPopup({
                    title: '‚≠ê Premium –¥–æ—Å—Ç—É–ø',
                    message: '–†–∞–∑–±–ª–æ–∫–∏—Ä—É–π Premium –∑–∞ 10 TON:\n‚Ä¢ x2 –∫–æ –≤—Å–µ–º –¥–æ—Ö–æ–¥–∞–º\n‚Ä¢ –ï–∂–µ–¥–Ω–µ–≤–Ω—ã–µ –±–æ–Ω—É—Å—ã\n‚Ä¢ –£–Ω–∏–∫–∞–ª—å–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è',
                    buttons: [
                        {id: 'buyPremium', type: 'default', text: '–ö—É–ø–∏—Ç—å –∑–∞ 10 TON'},
                        {type: 'cancel'}
                    ]
                }, (btnId) => {
                    if (btnId === 'buyPremium') {
                        if (game.balance >= 10) {
                            game.balance -= 10;
                            game.level = 10;
                            game.hashrate *= 2;
                            showNotification('‚≠ê Premium –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω! –£—Ä–æ–≤–µ–Ω—å 10, –¥–æ—Ö–æ–¥—ã x2!');
                            updateUI();
                            saveGame();
                        } else {
                            showNotification('‚ùå –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ TON –¥–ª—è Premium', true);
                        }
                    }
                });
            } else {
                showNotification('‚≠ê –í Telegram –¥–æ—Å—Ç—É–ø–µ–Ω Premium –¥–æ—Å—Ç—É–ø!', true);
            }
        }
        
        function shareGame() {
            if (isTelegram) {
                const url = window.location.href;
                const text = `üéÆ –Ø –∏–≥—Ä–∞—é –≤ TON Miner! –£–∂–µ –Ω–∞ $${game.price.toFixed(2)}! –ü—Ä–∏—Å–æ–µ–¥–∏–Ω—è–π—Å—è!`;
                tg.shareUrl(url, text);
            } else {
                const url = window.location.href;
                const text = `üéÆ TON Miner - –∫–∞—á–∞–π —Ü–µ–Ω—É TON –¥–æ –ª—É–Ω—ã! ${url}`;
                if (navigator.share) {
                    navigator.share({ title: 'TON Miner', text: text, url: url });
                } else {
                    navigator.clipboard.writeText(url);
                    showNotification('üìã –°—Å—ã–ª–∫–∞ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞!');
                }
            }
        }
        
        function claimDaily() {
            const today = new Date().toDateString();
            const lastBonus = localStorage.getItem('lastDailyBonus');
            
            if (lastBonus !== today) {
                const bonus = 100 + game.level * 20;
                game.balance += bonus;
                localStorage.setItem('lastDailyBonus', today);
                showNotification(`üéÅ –ï–∂–µ–¥–Ω–µ–≤–Ω—ã–π –±–æ–Ω—É—Å: ${bonus} TON!`);
                updateUI();
                saveGame();
            } else {
                showNotification('üéÅ –ë–æ–Ω—É—Å —É–∂–µ –ø–æ–ª—É—á–µ–Ω —Å–µ–≥–æ–¥–Ω—è! –ó–∞—Ö–æ–¥–∏ –∑–∞–≤—Ç—Ä–∞.', true);
            }
        }
        
        // ==================== –í–°–ü–û–ú–û–ì–ê–¢–ï–õ–¨–ù–´–ï –§–£–ù–ö–¶–ò–ò ====================
        function showNotification(text, color) {
            const notif = document.getElementById('notification');
            notif.textContent = text;
            notif.style.background = color || 'linear-gradient(135deg, #00ff88, #00cc66)';
            notif.style.color = color ? 'white' : '#003311';
            notif.style.display = 'block';
            
            setTimeout(() => {
                notif.style.display = 'none';
            }, 3000);
        }
        
        function updateUI() {
            // –¶–µ–Ω–∞ –∏ –≥—Ä–∞—Ñ–∏–∫
            document.getElementById('price').textContent = '$' + game.price.toFixed(2);
            document.getElementById('balance').textContent = Math.floor(game.balance);
            document.getElementById('hashrate').textContent = game.hashrate.toFixed(1);
            document.getElementById('friends').textContent = game.friends;
            document.getElementById('level').textContent = game.level;
            document.getElementById('playerBalance').textContent = Math.floor(game.balance);
            document.getElementById('playerLevel').textContent = game.level;
            
            // –ì—Ä–∞—Ñ–∏–∫
            const maxPrice = 100;
            const chartWidth = Math.min(20, Math.floor((game.price / maxPrice) * 20));
            document.getElementById('chart').textContent = 
                '[' + '‚ñÜ'.repeat(chartWidth) + ' '.repeat(20 - chartWidth) + ']';
            
            // –°–∏–ª–∞ –∫–ª–∏–∫–∞
            let clickPower = 0.01 + (game.upgrades.gpu * 0.003);
            if (game.upgrades.bot) clickPower *= 2;
            document.getElementById('growthRate').textContent = clickPower.toFixed(3);
            
            // –ê–≤—Ç–æ-—Ñ–µ—Ä–º–∞
            let autoPower = game.upgrades.farm * 25;
            if (game.upgrades.exchange) autoPower *= 3;
            document.getElementById('autoPerSecond').textContent = autoPower.toFixed(1);
            document.getElementById('autoTotal').textContent = Math.floor(game.autoMinedTotal);
            
            // –¶–µ–Ω—ã —É–ª—É—á—à–µ–Ω–∏–π
            document.getElementById('gpuPrice').textContent = 
                Math.floor(50 * Math.pow(1.2, game.upgrades.gpu)) + ' TON';
            document.getElementById('farmPrice').textContent = 
                Math.floor(250 * Math.pow(1.3, game.upgrades.farm)) + ' TON';
        }
        
        function saveGame() {
            if (isTelegram) {
                tg.CloudStorage.setItem('tonMinerSave', JSON.stringify(game));
            } else {
                localStorage.setItem('tonMinerSave', JSON.stringify(game));
            }
        }
        
        function hideLoading() {
            document.getElementById('loading').style.display = 'none';
            document.getElementById('gameContainer').style.display = 'block';
        }
        
        // ==================== –ó–ê–ü–£–°–ö –ò–ì–†–´ ====================
        window.addEventListener('DOMContentLoaded', () => {
            initTelegram();
            updateUI();
        });
        
        // –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ–º –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ
        document.addEventListener('touchmove', (e) => {
            if (e.scale !== 1) e.preventDefault();
        }, { passive: false });
    </script>
</body>
</html>
