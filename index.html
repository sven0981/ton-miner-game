<!DOCTYPE html>
<html>
<head>
    <title>TON Miner PRO - Multiplayer</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        /* ... –≤—Å–µ —Å—Ç–∏–ª–∏ –æ—Å—Ç–∞—é—Ç—Å—è —Ç–∞–∫–∏–º–∏ –∂–µ ... */
        /* –í—Å—Ç–∞–≤—å—Ç–µ —Å—é–¥–∞ CSS –∏–∑ –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ –æ—Ç–≤–µ—Ç–∞ */
    </style>
</head>
<body>
    <!-- –£–í–ï–î–û–ú–õ–ï–ù–ò–Ø -->
    <div class="notification" id="notification"></div>
    
    <!-- –ú–û–î–ê–õ–¨–ù–û–ï –û–ö–ù–û –°–û–ó–î–ê–ù–ò–Ø –ö–õ–ê–ù–ê -->
    <div class="modal" id="createClanModal" style="display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.8); z-index: 1000; align-items: center; justify-content: center;">
        <div style="background: linear-gradient(135deg, #0a0a0a, #050505); border-radius: 20px; padding: 25px; max-width: 400px; width: 100%; border: 3px solid #0088cc;">
            <div style="text-align: center; font-size: 1.5em; margin-bottom: 20px; color: #00ffff;">üõ°Ô∏è –°–û–ó–î–ê–¢–¨ –ö–õ–ê–ù</div>
            <input type="text" id="clanNameInput" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –∫–ª–∞–Ω–∞" style="width: 100%; padding: 15px; background: rgba(255,255,255,0.1); border: 2px solid #0088cc; border-radius: 10px; color: white; margin: 10px 0;">
            <textarea id="clanDescInput" placeholder="–û–ø–∏—Å–∞–Ω–∏–µ –∫–ª–∞–Ω–∞" style="width: 100%; padding: 15px; background: rgba(255,255,255,0.1); border: 2px solid #0088cc; border-radius: 10px; color: white; margin: 10px 0; min-height: 100px;"></textarea>
            <button onclick="confirmCreateClan()" style="width: 100%; padding: 15px; background: linear-gradient(135deg, #00cc88, #00aa66); color: white; border: none; border-radius: 10px; font-weight: bold; margin-top: 10px;">–°–û–ó–î–ê–¢–¨ –ó–ê 1000 TON</button>
            <button onclick="closeModal('createClanModal')" style="width: 100%; padding: 15px; background: rgba(255,255,255,0.1); color: white; border: none; border-radius: 10px; margin-top: 10px;">–û–¢–ú–ï–ù–ê</button>
        </div>
    </div>

    <div class="container">
        <!-- –®–ê–ü–ö–ê -->
        <div class="header">
            <h1>üöÄ TON MINER PRO</h1>
            <div class="subtitle">–ú–Ω–æ–≥–æ–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∞—è –∏–≥—Ä–∞!</div>
        </div>
        
        <!-- –°–¢–ê–¢–ò–°–¢–ò–ö–ê –°–ï–†–í–ï–†–ê -->
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-label">üë§ –ò–≥—Ä–æ–∫</div>
                <div class="stat-value" id="playerName">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">üí∞ –ë–∞–ª–∞–Ω—Å</div>
                <div class="stat-value" id="balance">0 TON</div>
            </div>
        </div>
        
        <!-- –û–ù–õ–ê–ô–ù –°–¢–ê–¢–ò–°–¢–ò–ö–ê -->
        <div class="stats-grid" id="serverStats" style="display: none;">
            <div class="stat-card">
                <div class="stat-label">üë• –û–Ω–ª–∞–π–Ω</div>
                <div class="stat-value" id="onlinePlayers">0</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">üèÜ –í—Å–µ–≥–æ –∏–≥—Ä–æ–∫–æ–≤</div>
                <div class="stat-value" id="totalPlayers">0</div>
            </div>
        </div>
        
        <!-- –¶–ï–ù–ê TON -->
        <div class="price-container">
            <div class="price-label">üí∞ –¶–ï–ù–ê TON</div>
            <div class="price" id="price">$1.00</div>
            <div class="chart" id="chart">[‚ñÜ‚ñÜ‚ñÜ‚ñÜ‚ñÜ‚ñÜ‚ñÜ‚ñÜ‚ñÜ‚ñÜ‚ñÜ‚ñÜ‚ñÜ‚ñÜ‚ñÜ‚ñÜ‚ñÜ‚ñÜ‚ñÜ‚ñÜ]</div>
            <div class="price-label">üìà +<span id="growthRate">0.01</span>/–∫–ª–∏–∫</div>
        </div>
        
        <!-- –û–°–ù–û–í–ù–ê–Ø –ö–ù–û–ü–ö–ê -->
        <button class="main-btn" onclick="clickTon()">
            <span>üöÄ</span>
            <span>–ù–ê–ö–ê–ß–ê–¢–¨ TON</span>
        </button>
        
        <!-- –í–ö–õ–ê–î–ö–ò -->
        <div class="tabs" id="tabs">
            <button class="tab active" onclick="switchTab('upgrades')">‚ö° –£–õ–£–ß–®–ï–ù–ò–Ø</button>
            <button class="tab" onclick="switchTab('top')">üèÜ –¢–û–ü 20</button>
            <button class="tab" onclick="switchTab('clans')">üë• –ö–õ–ê–ù–´</button>
            <button class="tab" onclick="switchTab('server')">üåê –°–ï–†–í–ï–†</button>
        </div>
        
        <!-- –í–ö–õ–ê–î–ö–ê: –£–õ–£–ß–®–ï–ù–ò–Ø -->
        <div class="tab-content active" id="upgradesTab">
            <div class="upgrade-card" onclick="buyUpgrade('gpu')">
                <div class="upgrade-header">
                    <div class="upgrade-name">
                        <span>üíª</span>
                        <span>–í–∏–¥–µ–æ–∫–∞—Ä—Ç–∞</span>
                    </div>
                    <div class="upgrade-count" id="gpuCount">0</div>
                </div>
                <div class="upgrade-desc">
                    +5 GH/s, +0.3% –∫ —Ü–µ–Ω–µ –∑–∞ –∫–ª–∏–∫
                </div>
                <div class="upgrade-price" id="gpuPrice">50 TON</div>
            </div>
            
            <div class="upgrade-card" onclick="buyUpgrade('farm')">
                <div class="upgrade-header">
                    <div class="upgrade-name">
                        <span>üåê</span>
                        <span>–ú–∞–π–Ω–∏–Ω–≥-—Ñ–µ—Ä–º–∞</span>
                    </div>
                    <div class="upgrade-count" id="farmCount">0</div>
                </div>
                <div class="upgrade-desc">
                    +25 GH/s –∞–≤—Ç–æ-–¥–æ–±—ã—á–∏, +1% –∫ —Ü–µ–Ω–µ
                </div>
                <div class="upgrade-price" id="farmPrice">250 TON</div>
            </div>
            
            <div class="upgrade-card" onclick="buyUpgrade('bot')" id="botUpgrade">
                <div class="upgrade-header">
                    <div class="upgrade-name">
                        <span>ü§ñ</span>
                        <span>–¢–æ—Ä–≥–æ–≤—ã–π –±–æ—Ç</span>
                    </div>
                    <div class="upgrade-count" id="botCount">0</div>
                </div>
                <div class="upgrade-desc">
                    x2 –∫ —Å–∏–ª–µ –∫–ª–∏–∫–æ–≤, –∞–≤—Ç–æ-—Ä–æ—Å—Ç —Ü–µ–Ω—ã
                </div>
                <div class="upgrade-price" id="botPrice">500 TON</div>
            </div>
            
            <div class="upgrade-card" onclick="buyUpgrade('exchange')" id="exchangeUpgrade">
                <div class="upgrade-header">
                    <div class="upgrade-name">
                        <span>üè¶</span>
                        <span>–ö—Ä–∏–ø—Ç–æ–±–∏—Ä–∂–∞</span>
                    </div>
                    <div class="upgrade-count" id="exchangeCount">0</div>
                </div>
                <div class="upgrade-desc">
                    x3 –∫ –∞–≤—Ç–æ-–¥–æ–±—ã—á–µ, +5% –∫ —Ü–µ–Ω–µ
                </div>
                <div class="upgrade-price" id="exchangePrice">2,000 TON</div>
            </div>
            
            <div class="upgrade-card" onclick="buyUpgrade('satellite')" id="satelliteUpgrade">
                <div class="upgrade-header">
                    <div class="upgrade-name">
                        <span>üõ∞Ô∏è</span>
                        <span>–°–ø—É—Ç–Ω–∏–∫–æ–≤—ã–π –º–∞–π–Ω–∏–Ω–≥</span>
                    </div>
                    <div class="upgrade-count" id="satelliteCount">0</div>
                </div>
                <div class="upgrade-desc">
                    x10 –∫–æ –≤—Å–µ–º –¥–æ—Ö–æ–¥–∞–º, VIP —Å—Ç–∞—Ç—É—Å
                </div>
                <div class="upgrade-price" id="satellitePrice">10,000 TON</div>
            </div>
        </div>
        
        <!-- –í–ö–õ–ê–î–ö–ê: –¢–û–ü –ò–ì–†–û–ö–ò -->
        <div class="tab-content" id="topTab">
            <div class="leaderboard">
                <div class="leaderboard-header">
                    <span>üèÜ –¢–û–ü-20 –ò–ì–†–û–ö–û–í</span>
                    <span>TON</span>
                </div>
                <div id="topPlayersList">
                    <div style="padding: 20px; text-align: center; color: #888;">
                        –ó–∞–≥—Ä—É–∑–∫–∞ —Ä–µ–π—Ç–∏–Ω–≥–∞...
                    </div>
                </div>
            </div>
            
            <div style="text-align: center; margin: 20px 0;">
                <div style="color: #88aaff; margin-bottom: 10px;">–í–∞—à–µ –º–µ—Å—Ç–æ –≤ —Ä–µ–π—Ç–∏–Ω–≥–µ:</div>
                <div style="font-size: 2em; color: #00ffaa; font-weight: bold;" id="playerRank">#0</div>
            </div>
        </div>
        
        <!-- –í–ö–õ–ê–î–ö–ê: –ö–õ–ê–ù–´ -->
        <div class="tab-content" id="clansTab">
            <div id="clansList">
                <div style="text-align: center; padding: 20px; color: #888;">
                    –ó–∞–≥—Ä—É–∑–∫–∞ –∫–ª–∞–Ω–æ–≤...
                </div>
            </div>
            
            <button class="tg-btn" onclick="showCreateClanModal()" style="width: 100%; margin: 15px 0;">
                <span>üõ°Ô∏è</span>
                <span>–°–û–ó–î–ê–¢–¨ –ù–û–í–´–ô –ö–õ–ê–ù (1000 TON)</span>
            </button>
        </div>
        
        <!-- –í–ö–õ–ê–î–ö–ê: –°–ï–†–í–ï–† -->
        <div class="tab-content" id="serverTab">
            <div style="text-align: center; padding: 20px;">
                <div style="font-size: 2em; margin-bottom: 20px;">üåê</div>
                <div style="font-size: 1.2em; font-weight: bold; margin-bottom: 10px; color: #00ffff;">
                    –°–¢–ê–¢–ò–°–¢–ò–ö–ê –°–ï–†–í–ï–†–ê
                </div>
                
                <div class="stats-grid" style="margin: 20px 0;">
                    <div class="stat-card">
                        <div class="stat-label">üë• –í—Å–µ–≥–æ –∏–≥—Ä–æ–∫–æ–≤</div>
                        <div class="stat-value" id="serverTotalPlayers">0</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">üõ°Ô∏è –í—Å–µ–≥–æ –∫–ª–∞–Ω–æ–≤</div>
                        <div class="stat-value" id="serverTotalClans">0</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">üí∞ –û–±—â–∏–π TON</div>
                        <div class="stat-value" id="serverTotalTON">0</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">üìä –°—Ä–µ–¥–Ω–∏–π —É—Ä–æ–≤–µ–Ω—å</div>
                        <div class="stat-value" id="serverAvgLevel">0</div>
                    </div>
                </div>
                
                <div style="color: #88aaff; margin-top: 20px;">
                    <div>üìÖ –ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:</div>
                    <div id="serverLastUpdate">-</div>
                </div>
            </div>
        </div>
        
        <!-- TELEGRAM –ö–ù–û–ü–ö–ò -->
        <div class="tg-buttons">
            <button class="tg-btn" onclick="inviteFriend()">
                <span>üë•</span>
                <span>–ü—Ä–∏–≥–ª–∞—Å–∏—Ç—å</span>
            </button>
            
            <button class="tg-btn premium" onclick="dailyBonus()">
                <span>üéÅ</span>
                <span>–ë–æ–Ω—É—Å</span>
            </button>
            
            <button class="tg-btn" onclick="saveGame()">
                <span>üíæ</span>
                <span>–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</span>
            </button>
            
            <button class="tg-btn" onclick="loadLeaderboard()">
                <span>üîÑ</span>
                <span>–û–±–Ω–æ–≤–∏—Ç—å</span>
            </button>
        </div>
    </div>

    <script>
        // ============ –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø ============
        const API_URL = 'http://localhost:3000'; // –ó–∞–º–µ–Ω–∏—Ç–µ –Ω–∞ –≤–∞—à —Å–µ—Ä–≤–µ—Ä
        
        let tg = window.Telegram.WebApp;
        let isTelegram = false;
        let userId = null;
        let playerName = "–ò–≥—Ä–æ–∫";
        
        // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        function getUserId() {
            if (tg && tg.initDataUnsafe && tg.initDataUnsafe.user) {
                isTelegram = true;
                tg.expand();
                tg.ready();
                return tg.initDataUnsafe.user.id.toString();
            }
            
            // –î–ª—è –±—Ä–∞—É–∑–µ—Ä–∞ - –∏—Å–ø–æ–ª—å–∑—É–µ–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–π ID –∏–ª–∏ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ–º –Ω–æ–≤—ã–π
            let browserId = localStorage.getItem('tonminer_user_id');
            if (!browserId) {
                browserId = 'browser_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
                localStorage.setItem('tonminer_user_id', browserId);
            }
            return browserId;
        }
        
        // –ü–æ–ª—É—á–∞–µ–º –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        function getPlayerName() {
            if (isTelegram && tg.initDataUnsafe.user) {
                return tg.initDataUnsafe.user.first_name || "–ò–≥—Ä–æ–∫";
            }
            return localStorage.getItem('tonminer_user_name') || "–ò–≥—Ä–æ–∫";
        }
        
        // ============ –ò–ì–†–ê ============
        let game = {
            version: '4.0',
            price: 1.00,
            balance: 0,
            hashrate: 1,
            level: 1,
            friends: 0,
            totalClicks: 0,
            totalEarned: 0,
            totalMined: 0,
            bestPrice: 1.00,
            
            upgrades: {
                gpu: 0,
                farm: 0,
                bot: false,
                exchange: false,
                satellite: false
            },
            
            clan: {
                id: null,
                name: '',
                role: null,
                joined: false
            }
        };
        
        // ============ API –§–£–ù–ö–¶–ò–ò ============
        
        // –ó–∞–≥—Ä—É–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –∏–≥—Ä–æ–∫–∞
        async function loadGame() {
            userId = getUserId();
            playerName = getPlayerName();
            
            document.getElementById('playerName').textContent = playerName;
            
            try {
                const response = await fetch(`${API_URL}/api/player/${userId}?name=${encodeURIComponent(playerName)}`);
                const data = await response.json();
                
                if (data.success) {
                    Object.assign(game, data.player);
                    console.log('‚úÖ –ò–≥—Ä–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞ —Å —Å–µ—Ä–≤–µ—Ä–∞');
                    console.log('üí∞ –ë–∞–ª–∞–Ω—Å:', game.balance);
                    
                    showNotification(`üéÆ –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, ${playerName}! –ë–∞–ª–∞–Ω—Å: ${formatNumber(game.balance)} TON`, 'success');
                }
            } catch (error) {
                console.log('‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∏–≥—Ä—ã:', error);
                showNotification('‚ùå –û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å —Å–µ—Ä–≤–µ—Ä–æ–º', 'error');
            }
            
            initGame();
        }
        
        // –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–≥—Ä—É
        async function saveGame() {
            try {
                const response = await fetch(`${API_URL}/api/player/${userId}/save`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(game)
                });
                
                const data = await response.json();
                
                if (data.success) {
                    console.log('üíæ –ò–≥—Ä–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ');
                    showNotification('üíæ –ü—Ä–æ–≥—Ä–µ—Å—Å —Å–æ—Ö—Ä–∞–Ω–µ–Ω!', 'success');
                }
            } catch (error) {
                console.log('‚ùå –û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –∏–≥—Ä—ã:', error);
                showNotification('‚ùå –û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è', 'error');
            }
        }
        
        // –ö—É–ø–∏—Ç—å —É–ª—É—á—à–µ–Ω–∏–µ —á–µ—Ä–µ–∑ API
        async function buyUpgrade(type) {
            try {
                const response = await fetch(`${API_URL}/api/player/${userId}/buy-upgrade`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ upgradeType: type })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    Object.assign(game, data.player);
                    showNotification(data.message, 'success');
                    updateUI();
                    loadLeaderboard(); // –û–±–Ω–æ–≤–ª—è–µ–º —Ä–µ–π—Ç–∏–Ω–≥
                } else {
                    showNotification(data.message, 'error');
                }
            } catch (error) {
                console.log('‚ùå –û—à–∏–±–∫–∞ –ø–æ–∫—É–ø–∫–∏:', error);
                showNotification('‚ùå –û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å —Å–µ—Ä–≤–µ—Ä–æ–º', 'error');
            }
        }
        
        // –ó–∞–≥—Ä—É–∑–∏—Ç—å —Ç–æ–ø –∏–≥—Ä–æ–∫–æ–≤
        async function loadLeaderboard() {
            try {
                const response = await fetch(`${API_URL}/api/leaderboard`);
                const data = await response.json();
                
                if (data.success) {
                    updateTopPlayers(data.leaderboard);
                    updatePlayerRank(data.leaderboard);
                }
            } catch (error) {
                console.log('‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ä–µ–π—Ç–∏–Ω–≥–∞:', error);
            }
        }
        
        // –ó–∞–≥—Ä—É–∑–∏—Ç—å –∫–ª–∞–Ω—ã
        async function loadClans() {
            try {
                const response = await fetch(`${API_URL}/api/clans`);
                const data = await response.json();
                
                if (data.success) {
                    updateClansList(data.clans);
                }
            } catch (error) {
                console.log('‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–ª–∞–Ω–æ–≤:', error);
            }
        }
        
        // –ó–∞–≥—Ä—É–∑–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É —Å–µ—Ä–≤–µ—Ä–∞
        async function loadServerStats() {
            try {
                const response = await fetch(`${API_URL}/api/stats`);
                const data = await response.json();
                
                if (data.success) {
                    updateServerStats(data.stats);
                }
            } catch (error) {
                console.log('‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏:', error);
            }
        }
        
        // –°–æ–∑–¥–∞—Ç—å –∫–ª–∞–Ω
        async function createClanAPI(clanName, description) {
            try {
                const response = await fetch(`${API_URL}/api/clans/create`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        userId: userId,
                        clanName: clanName,
                        description: description
                    })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    // –û–±–Ω–æ–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –∏–≥—Ä–æ–∫–∞
                    const playerResponse = await fetch(`${API_URL}/api/player/${userId}`);
                    const playerData = await playerResponse.json();
                    
                    if (playerData.success) {
                        Object.assign(game, playerData.player);
                    }
                    
                    showNotification(data.message, 'success');
                    loadClans();
                    updateUI();
                    closeModal('createClanModal');
                } else {
                    showNotification(data.message, 'error');
                }
            } catch (error) {
                console.log('‚ùå –û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –∫–ª–∞–Ω–∞:', error);
                showNotification('‚ùå –û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å —Å–µ—Ä–≤–µ—Ä–æ–º', 'error');
            }
        }
        
        // –í—Å—Ç—É–ø–∏—Ç—å –≤ –∫–ª–∞–Ω
        async function joinClanAPI(clanId) {
            try {
                const response = await fetch(`${API_URL}/api/clans/join`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        userId: userId,
                        clanId: clanId
                    })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    // –û–±–Ω–æ–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –∏–≥—Ä–æ–∫–∞
                    const playerResponse = await fetch(`${API_URL}/api/player/${userId}`);
                    const playerData = await playerResponse.json();
                    
                    if (playerData.success) {
                        Object.assign(game, playerData.player);
                    }
                    
                    showNotification(data.message, 'success');
                    loadClans();
                    updateUI();
                } else {
                    showNotification(data.message, 'error');
                }
            } catch (error) {
                console.log('‚ùå –û—à–∏–±–∫–∞ –≤—Å—Ç—É–ø–ª–µ–Ω–∏—è –≤ –∫–ª–∞–Ω:', error);
                showNotification('‚ùå –û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å —Å–µ—Ä–≤–µ—Ä–æ–º', 'error');
            }
        }
        
        // ============ –ò–ì–†–û–í–´–ï –§–£–ù–ö–¶–ò–ò ============
        
        function initGame() {
            updateUI();
            updateGoal();
            unlockUpgrades();
            
            // –ó–∞–≥—Ä—É–∂–∞–µ–º –æ–±—â–∏–µ –¥–∞–Ω–Ω—ã–µ
            loadLeaderboard();
            loadClans();
            loadServerStats();
            
            // –ó–∞–ø—É—Å–∫–∞–µ–º –∞–≤—Ç–æ-—Å–∏—Å—Ç–µ–º—ã
            if (game.upgrades.farm > 0) {
                startAutoFarm();
            }
            if (game.upgrades.bot) {
                startAutoClicks();
            }
            if (game.upgrades.exchange) {
                startAutoTrading();
            }
            
            // –ê–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥
            setInterval(saveGame, 30000);
            
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
            setInterval(updateUI, 1000);
            
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ–±—â–∏—Ö –¥–∞–Ω–Ω—ã—Ö –∫–∞–∂–¥—É—é –º–∏–Ω—É—Ç—É
            setInterval(() => {
                loadLeaderboard();
                loadClans();
                loadServerStats();
            }, 60000);
        }
        
        function clickTon() {
            game.totalClicks++;
            
            let clickPower = 0.01;
            let hashPower = game.hashrate;
            
            clickPower += game.upgrades.gpu * 0.003;
            hashPower += game.upgrades.gpu * 5;
            
            if (game.upgrades.bot) clickPower *= 2;
            if (game.upgrades.exchange) clickPower *= 1.5;
            if (game.upgrades.satellite) {
                clickPower *= 10;
                hashPower *= 10;
            }
            
            if (game.clan.joined) {
                clickPower *= 1.05;
                hashPower *= 1.05;
            }
            
            game.price += clickPower + (Math.random() * 0.01);
            if (game.price > game.bestPrice) {
                game.bestPrice = game.price;
            }
            
            const mined = hashPower * (1 + game.friends * 0.1);
            game.balance += mined;
            game.totalEarned += mined;
            game.totalMined += mined;
            
            // –°–ª—É—á–∞–π–Ω—ã–π –ø–∞–º–ø
            if (Math.random() < 0.03) {
                const pump = 0.1 + (game.upgrades.gpu * 0.01);
                game.price *= (1 + pump);
                showNotification(`üìà –ü–ê–ú–ü! –¶–µ–Ω–∞ +${(pump*100).toFixed(1)}%!`, 'success');
            }
            
            updateUI();
            updateGoal();
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∫–∞–∂–¥—ã–µ 10 –∫–ª–∏–∫–æ–≤
            if (game.totalClicks % 10 === 0) {
                saveGame();
            }
            
            // –ê–Ω–∏–º–∞—Ü–∏—è
            const priceEl = document.getElementById('price');
            priceEl.style.transform = 'scale(1.15)';
            setTimeout(() => priceEl.style.transform = 'scale(1)', 150);
        }
        
        // ============ –ê–í–¢–û-–°–ò–°–¢–ï–ú–´ ============
        let autoFarmInterval;
        function startAutoFarm() {
            if (autoFarmInterval) clearInterval(autoFarmInterval);
            
            autoFarmInterval = setInterval(() => {
                if (game.upgrades.farm > 0) {
                    let farmPower = game.upgrades.farm * 25;
                    if (game.upgrades.exchange) farmPower *= 3;
                    if (game.upgrades.satellite) farmPower *= 10;
                    
                    game.balance += farmPower;
                    game.totalEarned += farmPower;
                    game.totalMined += farmPower;
                    updateUI();
                }
            }, 1000);
        }
        
        let autoClickInterval;
        function startAutoClicks() {
            if (autoClickInterval) clearInterval(autoClickInterval);
            
            autoClickInterval = setInterval(() => {
                if (game.upgrades.bot) {
                    for (let i = 0; i < 5; i++) {
                        game.totalClicks++;
                        game.price += 0.002;
                        game.balance += game.hashrate * 0.2;
                        game.totalMined += game.hashrate * 0.2;
                    }
                    updateUI();
                }
            }, 1000);
        }
        
        let autoTradeInterval;
        function startAutoTrading() {
            if (autoTradeInterval) clearInterval(autoTradeInterval);
            
            autoTradeInterval = setInterval(() => {
                if (game.upgrades.exchange) {
                    const profit = Math.random() * 10 - 3;
                    game.balance += profit;
                    game.totalMined += profit;
                    
                    if (profit > 5) {
                        showNotification(`üìà –£–¥–∞—á–Ω–∞—è —Å–¥–µ–ª–∫–∞: +${profit.toFixed(2)} TON`, 'success');
                    }
                    
                    updateUI();
                }
            }, 5000);
        }
        
        // ============ –ò–ù–¢–ï–†–§–ï–ô–° ============
        
        function updateUI() {
            document.getElementById('price').textContent = '$' + game.price.toFixed(2);
            document.getElementById('balance').textContent = formatNumber(game.balance) + ' TON';
            document.getElementById('hashrate').textContent = formatNumber(game.hashrate) + ' GH/s';
            document.getElementById('friends').textContent = game.friends;
            document.getElementById('level').textContent = game.level;
            
            let growth = 0.01 + (game.upgrades.gpu * 0.003);
            if (game.upgrades.bot) growth *= 2;
            if (game.upgrades.satellite) growth *= 10;
            document.getElementById('growthRate').textContent = growth.toFixed(3);
            
            const maxPrice = 1000;
            const chartWidth = Math.min(20, Math.floor((game.price / maxPrice) * 20));
            document.getElementById('chart').textContent = 
                '[' + '‚ñÜ'.repeat(chartWidth) + ' '.repeat(20 - chartWidth) + ']';
            
            document.getElementById('gpuCount').textContent = game.upgrades.gpu;
            document.getElementById('farmCount').textContent = game.upgrades.farm;
            document.getElementById('botCount').textContent = game.upgrades.bot ? '‚úì' : '0';
            document.getElementById('exchangeCount').textContent = game.upgrades.exchange ? '‚úì' : '0';
            document.getElementById('satelliteCount').textContent = game.upgrades.satellite ? '‚úì' : '0';
            
            document.getElementById('gpuPrice').textContent = formatNumber(Math.floor(50 * Math.pow(1.25, game.upgrades.gpu))) + ' TON';
            document.getElementById('farmPrice').textContent = formatNumber(Math.floor(250 * Math.pow(1.3, game.upgrades.farm))) + ' TON';
            document.getElementById('botPrice').textContent = '500 TON';
            document.getElementById('exchangePrice').textContent = '2,000 TON';
            document.getElementById('satellitePrice').textContent = '10,000 TON';
            
            let autoPower = game.upgrades.farm * 25;
            if (game.upgrades.exchange) autoPower *= 3;
            if (game.upgrades.satellite) autoPower *= 10;
            document.getElementById('autoIncome').textContent = formatNumber(autoPower) + '/—Å–µ–∫';
        }
        
        function updateGoal() {
            const progress = (game.price / 1000) * 100;
            document.getElementById('goalProgress').textContent = progress.toFixed(1) + '%';
            document.getElementById('goalBar').style.width = Math.min(100, progress) + '%';
            
            if (game.price >= 1000 && !game.achievedGoal) {
                game.achievedGoal = true;
                game.balance += 10000;
                showNotification('üèÜ –ü–û–ë–ï–î–ê! –í—ã –¥–æ—Å—Ç–∏–≥–ª–∏ $1000! +10,000 TON!', 'success');
                saveGame();
            }
        }
        
        function unlockUpgrades() {
            if (game.price >= 5 && !game.upgrades.bot) {
                document.getElementById('botUpgrade').style.display = 'block';
            }
            
            if (game.price >= 20 && !game.upgrades.exchange) {
                document.getElementById('exchangeUpgrade').style.display = 'block';
            }
            
            if (game.price >= 50 && !game.upgrades.satellite) {
                document.getElementById('satelliteUpgrade').style.display = 'block';
            }
        }
        
        function updateTopPlayers(players) {
            const container = document.getElementById('topPlayersList');
            container.innerHTML = '';
            
            if (players.length === 0) {
                container.innerHTML = '<div style="padding: 20px; text-align: center; color: #888;">–ü–æ–∫–∞ –Ω–µ—Ç –∏–≥—Ä–æ–∫–æ–≤</div>';
                return;
            }
            
            players.forEach((player, index) => {
                const item = document.createElement('div');
                item.className = 'leaderboard-item';
                item.style.display = 'flex';
                item.style.justifyContent = 'space-between';
                item.style.alignItems = 'center';
                item.style.padding = '12px 15px';
                item.style.borderBottom = '1px solid rgba(255,255,255,0.1)';
                
                if (index % 2 === 0) {
                    item.style.background = 'rgba(255,255,255,0.03)';
                }
                
                let rankClass = 'player-rank';
                if (index === 0) rankClass += ' top1';
                else if (index === 1) rankClass += ' top2';
                else if (index === 2) rankClass += ' top3';
                
                item.innerHTML = `
                    <div style="display: flex; align-items: center; gap: 10px;">
                        <div class="${rankClass}" style="width: 30px; height: 30px; display: flex; align-items: center; justify-content: center; border-radius: 50%; font-weight: bold;">
                            ${index + 1}
                        </div>
                        <div>
                            <div style="font-weight: bold;">${player.name}</div>
                            ${player.clan && player.clan.name ? 
                                `<div style="font-size: 0.8em; color: #88aaff;">${player.clan.name}</div>` : ''}
                        </div>
                    </div>
                    <div style="font-weight: bold; color: #00ffaa;">${formatNumber(player.totalMined)} TON</div>
                `;
                
                container.appendChild(item);
            });
        }
        
        function updatePlayerRank(players) {
            const playerIndex = players.findIndex(p => p.id === userId);
            document.getElementById('playerRank').textContent = playerIndex !== -1 ? '#' + (playerIndex + 1) : '#' + (players.length + 1);
        }
        
        function updateClansList(clans) {
            const container = document.getElementById('clansList');
            container.innerHTML = '';
            
            if (clans.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 30px; color: #88aaff;">
                        <div style="font-size: 2em; margin-bottom: 20px;">üõ°Ô∏è</div>
                        <div style="font-size: 1.2em; font-weight: bold; margin-bottom: 10px;">
                            –ö–õ–ê–ù–´ –ü–û–ö–ê –ù–ï –°–û–ó–î–ê–ù–´
                        </div>
                        <div style="color: #aaa;">
                            –ë—É–¥—å—Ç–µ –ø–µ—Ä–≤—ã–º, –∫—Ç–æ —Å–æ–∑–¥–∞—Å—Ç –∫–ª–∞–Ω!
                        </div>
                    </div>
                `;
                return;
            }
            
            clans.forEach(clan => {
                const isMember = game.clan.id === clan.id;
                
                const card = document.createElement('div');
                card.className = 'clan-card';
                card.style.background = 'linear-gradient(135deg, rgba(0,100,200,0.25), rgba(0,50,150,0.35))';
                card.style.borderRadius = '18px';
                card.style.padding = '20px';
                card.style.margin = '15px 0';
                card.style.border = '2px solid #0088ff';
                
                card.innerHTML = `
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
                        <div style="font-size: 1.3em; font-weight: bold; color: white; display: flex; align-items: center; gap: 10px;">
                            <span>üõ°Ô∏è</span>
                            <span>${clan.name}</span>
                        </div>
                        <div style="background: rgba(255,204,0,0.2); color: #ffcc00; padding: 4px 12px; border-radius: 20px; font-weight: bold; font-size: 0.9em;">
                            –£—Ä. ${clan.level}
                        </div>
                    </div>
                    <div style="display: flex; gap: 15px; margin: 10px 0; color: #88ccff; font-size: 0.9em;">
                        <div>üë• ${clan.members.length}/${clan.maxMembers}</div>
                        <div>üí∞ ${formatNumber(clan.totalEarned || 0)} TON</div>
                    </div>
                    <div style="color: #88ccff; margin: 10px 0; font-size: 0.9em;">
                        ${clan.description || '–ë–µ–∑ –æ–ø–∏—Å–∞–Ω–∏—è'}
                    </div>
                    <div style="color: #ffcc00; font-size: 0.8em; margin-bottom: 10px;">
                        –õ–∏–¥–µ—Ä: ${clan.leaderName}
                    </div>
                    <button onclick="joinClanAPI('${clan.id}')" style="background: linear-gradient(135deg, #00cc88, #00aa66); color: white; border: none; border-radius: 10px; padding: 8px 15px; font-size: 0.9em; cursor: pointer; width: 100%;"
                            ${isMember ? 'disabled style="background: rgba(255,255,255,0.2); cursor: default;"' : ''}>
                        ${isMember ? '‚úÖ –í–´ –í –ö–õ–ê–ù–ï' : 'ü§ù –í–°–¢–£–ü–ò–¢–¨'}
                    </button>
                `;
                
                container.appendChild(card);
            });
        }
        
        function updateServerStats(stats) {
            document.getElementById('serverStats').style.display = 'grid';
            document.getElementById('onlinePlayers').textContent = stats.onlinePlayers;
            document.getElementById('totalPlayers').textContent = stats.totalPlayers;
            document.getElementById('serverTotalPlayers').textContent = stats.totalPlayers;
            document.getElementById('serverTotalClans').textContent = stats.totalClans;
            document.getElementById('serverTotalTON').textContent = formatNumber(stats.totalTON);
            document.getElementById('serverAvgLevel').textContent = stats.averageLevel.toFixed(1);
            document.getElementById('serverLastUpdate').textContent = new Date(stats.lastUpdate).toLocaleString();
        }
        
        // ============ –í–°–ü–û–ú–û–ì–ê–¢–ï–õ–¨–ù–´–ï –§–£–ù–ö–¶–ò–ò ============
        
        function switchTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            document.getElementById(tabName + 'Tab').classList.add('active');
            event.target.classList.add('active');
            
            // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è –≤–∫–ª–∞–¥–∫–∏
            if (tabName === 'top') {
                loadLeaderboard();
            } else if (tabName === 'clans') {
                loadClans();
            } else if (tabName === 'server') {
                loadServerStats();
            }
        }
        
        function showCreateClanModal() {
            if (game.balance < 1000) {
                showNotification('‚ùå –ù—É–∂–Ω–æ 1000 TON –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∫–ª–∞–Ω–∞', 'error');
                return;
            }
            
            document.getElementById('createClanModal').style.display = 'flex';
        }
        
        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }
        
        function confirmCreateClan() {
            const clanName = document.getElementById('clanNameInput').value.trim();
            const description = document.getElementById('clanDescInput').value.trim();
            
            if (!clanName || clanName.length < 3 || clanName.length > 20) {
                showNotification('‚ùå –ù–∞–∑–≤–∞–Ω–∏–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –æ—Ç 3 –¥–æ 20 —Å–∏–º–≤–æ–ª–æ–≤', 'error');
                return;
            }
            
            createClanAPI(clanName, description);
        }
        
        function inviteFriend() {
            const refLink = `${API_URL}/?ref=${userId}`;
            const message = `üéÆ –ü—Ä–∏—Å–æ–µ–¥–∏–Ω—è–π—Å—è –∫ TON Miner PRO! –ò—Å–ø–æ–ª—å–∑—É–π –º–æ—é —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω—É—é —Å—Å—ã–ª–∫—É: ${refLink}`;
            
            if (isTelegram) {
                tg.shareUrl(refLink, message);
            } else {
                navigator.clipboard.writeText(message);
                showNotification('üìã –°–æ–æ–±—â–µ–Ω–∏–µ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ! –û—Ç–ø—Ä–∞–≤—å—Ç–µ –µ–≥–æ –¥—Ä—É–≥—É', 'success');
            }
        }
        
        function dailyBonus() {
            const today = new Date().toDateString();
            const lastBonus = localStorage.getItem(`daily_bonus_${userId}`);
            
            if (lastBonus !== today) {
                const bonus = 500 + (game.level * 100);
                game.balance += bonus;
                localStorage.setItem(`daily_bonus_${userId}`, today);
                showNotification(`üéÅ –ï–ñ–ï–î–ù–ï–í–ù–´–ô –ë–û–ù–£–°: ${formatNumber(bonus)} TON!`, 'success');
                updateUI();
                saveGame();
            } else {
                showNotification('üéÅ –ë–æ–Ω—É—Å —É–∂–µ –ø–æ–ª—É—á–µ–Ω —Å–µ–≥–æ–¥–Ω—è!', 'warning');
            }
        }
        
        function showNotification(text, type = 'success') {
            const notif = document.getElementById('notification');
            notif.textContent = text;
            notif.className = 'notification';
            
            if (type === 'error') {
                notif.classList.add('error');
            } else if (type === 'warning') {
                notif.classList.add('warning');
            }
            
            notif.style.display = 'block';
            
            setTimeout(() => {
                notif.style.display = 'none';
            }, 3000);
        }
        
        function formatNumber(num) {
            if (num >= 1000000) return (num / 1000000).toFixed(1) + 'M';
            if (num >= 1000) return (num / 1000).toFixed(1) + 'K';
            return Math.floor(num);
        }
        
        // ============ –ó–ê–ü–£–°–ö ============
        window.addEventListener('DOMContentLoaded', () => {
            loadGame();
        });
    </script>
</body>
</html>
